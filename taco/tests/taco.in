#!/bin/sh

set_env() {
DSHOME=@abs_top_builddir@/tests/test/@prefix@
srcdir=`grep '^srcdir' @abs_top_builddir@/tests/Makefile | cut -d' ' -f 3`
prefix=@abs_top_builddir@/tests/test/@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
sbindir=@sbindir@
sysconfdir=@sysconfdir@
templatedir=@templatedir@
top_builddir=@abs_top_builddir@
testbindir=${top_builddir}/tests
appdefaultdir=@appdefaultdir@
LD_LIBRARY_PATH=@libdir@${LD_LIBRARY_PATH:+:}
}

unset NETHOST
set_env
if test $# -gt 0 ; then
	case $1 in 
		--version)	echo @PACKAGE_VERSION@;;
		install) if [ -d test ] ; then
				rm -rf test
			fi
			if { mkdir test; } ; then
				dc_destdir=$testbindir/test
				make -C $top_builddir DESTDIR=$dc_destdir install >/dev/null 2>&1
				exit $?
			fi
			exit 1;;
		start)
			. $templatedir/tacoenv.sh
			mkdir -p ${LOGPATH}
			set_env
			export TACO_PATH=$sbindir
			$sbindir/taco.startup >log 2>&1
			exit 0;;
		stop)
			. $templatedir/tacoenv.sh
			killall Manager
			;;
		uninstall)
			dc_destdir=$testbindir/test
			make -C $top_builddir DESTDIR=$dc_destdir uninstall >/dev/null 2>&1
			dir=`echo $prefix | cut -d'/' -f 1`
			if [ -z "$dir" ] ; then
				dir=`echo $prefix | cut -d'/' -f 2`
			fi
			rm -rf ${dc_destdir}/$dir
			dir=`aclocal --print-ac-dir | cut -d'/' -f 1`
			if [ -z "$dir" ] ; then
				dir=`aclocal --print-ac-dir | cut -d'/' -f 2`
			fi
			rm -rf ${dc_destdir}/$dir
			dir=`echo $appdefaultdir|cut -d'/' -f1` 
			if [ -z "$dir" ] ; then
				dir=`echo $appdefaultdir|cut -d'/' -f2` 
			fi
			rm -rf ${dc_destdir}/$dir
			if { rmdir $testbindir/test; } ; then
				exit 0
			fi
			exit 1 ;;
		unreg)
			. $templatedir/tacoenv.sh
			set_env
			shift 1
			$sbindir/unreg $@ ;;

		dbm_server)
			. $templatedir/tacoenv.sh
			set_env
			shift 1
			$sbindir/dbm_server dbm `uname -n|cut -f1 -d'.'` ;;
		ldd)
			. $templatedir/tacoenv.sh
			set_env
			shift 1
			ldd $bindir/$1 ;;
		StartServer)
			. $templatedir/tacoenv.sh
			set_env
			prog=$1
			shift 1
			$sbindir/$prog $@;;
		*)
			. $templatedir/tacoenv.sh
			set_env
			prog=$1
			shift 1
			$bindir/$prog $@;;
	esac
else
	export LD_LIBRARY_PATH
	export sysconfdir
	export templatedir
fi
