#!/bin/sh

set_env() {
DSHOME=@abs_top_builddir@/tests/test/@prefix@
srcdir=`grep '^srcdir' @abs_top_builddir@/tests/Makefile | cut -d' ' -f 3`
prefix=@abs_top_builddir@/tests/test/@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
sbindir=@sbindir@
sysconfdir=@sysconfdir@
top_builddir=@abs_top_builddir@
testbindir=${top_builddir}/tests

}

set_env

if test $# -gt 0 ; then
	case $1 in 
		--version)	echo @PACKAGE_VERSION@;;
		install) if [ -d test ] ; then
				rm -rf test
			fi
			if { mkdir test; } ; then
				dc_destdir=$testbindir/test
				make -C $top_builddir DESTDIR=$dc_destdir install >/dev/null 2>&1
				. $sysconfdir/tacoenv.sh
				set_env
				export TACO_PATH=$sbindir
				$sbindir/taco.startup >log 2>&1
				exit 0
			fi
			exit 1;;
		uninstall)
			. $sysconfdir/tacoenv.sh
			killall Manager
			dc_destdir=$testbindir/test
			make -C $topsrcdir DESTDIR=$dc_destdir uninstall >/dev/null 2>&1
			dir=`echo $prefix | cut -d'/' -f 1`
			if [ -z "$dir" ] ; then
				dir=`echo $prefix | cut -d'/' -f 2`
			fi
			rm -rf ${dc_destdir}/$dir
			dir=`aclocal --print-ac-dir | cut -d'/' -f 1`
			if [ -z "$dir" ] ; then
				dir=`aclocal --print-ac-dir | cut -d'/' -f 2`
			fi
			rm -rf ${dc_destdir}/$dir
			if { rmdir $testbindir/test; } ; then
				exit 0
			fi
			exit 1 ;;
		unreg)
			. $sysconfdir/tacoenv.sh
			set_env
			shift 1
			$sbindir/unreg $@ ;;

		dbm_server)
			. $sysconfdir/tacoenv.sh
			set_env
			shift 1
			$sbindir/dbm_server dbm `uname -n` ;;
		ldd)
			. $sysconfdir/tacoenv.sh
			set_env
			shift 1
			ldd $bindir/$1 ;;
		StartServer)
			. $sysconfdir/tacoenv.sh
			set_env
			prog=$1
			shift 1
			$sbindir/$prog $@;;
		*)
			. $sysconfdir/tacoenv.sh
			set_env
			prog=$1
			shift 1
			$bindir/$prog $@;;
	esac
fi
