AT_SETUP([Start Inst_verify server])
AT_DATA([instverify], [[3 
0
]])
AT_CHECK([nohup taco Inst_verify 1 >/dev/null &
sleep 1])
AT_CLEANUP

AT_SETUP([ping to the device test/device1/1])
AT_CHECK([. taco
. $sysconfdir/tacoenv.sh
dev_ping -c 3 test/device/1 | grep status | cut -d' ' -f 4 | uniq], [],
[[status=OK
]])
AT_CLEANUP

AT_SETUP([client to the device])
AT_DATA([instverify], [[3
0
]])
AT_CHECK([taco Inst_verify_menu test/device/1 < instverify], [1], [[
test_menu for test/device/1 (Inst_verifyClass)
____________________________________
1.State 	2.Status 
3.ReadValue  	4.SetValue 

Select one commands (0 to quit) : ? 
Set  value = 0.0
Read value = 0.0
State      = 2

test_menu for test/device/1 (Inst_verifyClass)
____________________________________
1.State 	2.Status 
3.ReadValue  	4.SetValue 

Select one commands (0 to quit) : ? 
]])
AT_CLEANUP

AT_SETUP([])
AT_CHECK([taco db_devinfo test/device/1 | egrep "(belongs|monitored)" ], [], 
[[Device test/device/1 belongs to class : Inst_verifyClass
It is monitored by the server : inst_verify/1 version 4
]])
AT_CLEANUP

AT_SETUP([])
AT_CHECK([taco db_devinfo test/device/x], [255], 
[[The device test/device/x is not defined in the database
]])
AT_CLEANUP

AT_SETUP([])
AT_CHECK([killall Inst_verify])
AT_CLEANUP
